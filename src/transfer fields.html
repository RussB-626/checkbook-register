<input type="text" readonly="" class="form-control-plaintext" id="transfer-withdrawal-txn-type" value="TW" style="display: none;">
<input type="text" readonly="" class="form-control-plaintext" id="transfer-deposit-txn-type" value="TD" style="display: none;">
<div class="row">
  <div class="col">
    <label for="transfer-date-input">Transfer Date:</label>
    <input type="date" class="form-control" id="transfer-date-input" name="input-dates"/>
  </div>
</div>

<br>
<div class="row">
  <div class="col">
    <label for="transfer-from-account-select">Transfer From Account:</label>
    <select class="custom-select" id="transfer-from-account-select" name="input-fields">
    </select>
    <div class="invalid-feedback">Missing From Acount Selection.</div>
  </div>
</div>

<br>
<div class="row">
  <div class="col">
    <label for="transfer-to-account-select">Transfer To Account:</label>
    <select class="custom-select" id="transfer-to-account-select" name="input-fields">
    </select>
    <div class="invalid-feedback">Missing To Acount Selection.</div>
  </div>
</div>

<br>
<div class="row">
  <div class="col">
    <label for="transfer-category-select">Transfer Category:</label>
    <select class="custom-select" id="transfer-category-select" name="input-fields">
    </select>
    <div class="invalid-feedback">Missing Category Selection.</div>
  </div>
</div>

<br>
<div class="row">
  <div class="col-sm">
    <label for="transfer-description-input">Transfer Description:</label>
    <input type="text" class="form-control" id="transfer-description-input" name="input-fields" list="description-datalist">
    <datalist id="description-datalist">
    </datalist>
  </div>
</div>

<br>
<div class="row">
  <div class="col-sm">
    <label for="transfer-description-input">Note:</label>
    <input type="text" class="form-control" id="transfer-note-input" name="input-fields">
  </div>
</div>

<br>
<div class="row">
  <div class="col-md-8">
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label class="control-label" for="transfer-amount-input">Transfer Amount</label>
      <div class="form-group">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">$</span>
          </div>
          <input type="number" class="form-control" min="0.00" max="1000000.00" step="0.01" id="transfer-amount-input" name="input-fields">
          <div class="invalid-feedback">Missing Transfer Amount.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col text-right">
    <div class="form-check">
      <label class="form-check-label">
      <input class="form-check-input" type="checkbox" id="transfer-pending-checkbox"  name="input-pending" value="">
      Pending Charge
      </label>
    </div>
  </div>
</div>

<br>
<div class="row">
  <div class="col text-right">
    <button type="button" class="btn btn-primary" onclick="createTransferTxns();" >Submit</button>
    <button type="button" class="btn btn-secondary" onclick="resetInputFields();">Reset</button>
  </div>
</div>

<!-- ========================================================================================== -->

<script>
  function transferFields() {
    return [
      {id : 'transfer-date-input', class : 'form-control', check : true, type : 'value'},
      {id : 'transfer-from-account-select', class : 'custom-select', check : true, type : 'value'},
      {id : 'transfer-to-account-select', class : 'custom-select', check : true, type : 'value'},
      {id : 'transfer-category-select', class : 'custom-select', check : true, type : 'value'},
      {id : 'transfer-description-input', class : 'form-control', check : true, type : 'value'},
      {id : 'transfer-note-input', class : 'form-control', check : false, type : 'value'},
      {id : 'transfer-amount-input', class : 'form-control', check : true, type : 'value'},
      {id : 'transfer-pending-checkbox', class : 'form-check-input', check : false, type : 'checked'}
    ];
  }
  
  // ==========================================================================================

  function transferTxn1Fields() {
    return [
      {id : 'transfer-date-input', type : 'value'},
      {id : 'transfer-from-account-select', type : 'value'},
      {id : 'transfer-category-select', type : 'value'},
      {id : 'transfer-description-input', type : 'value'},
      {id : 'transfer-note-input', type : 'value'},
      {id : 'transfer-amount-input', type : 'value'},
      {id : 'transfer-withdrawal-txn-type', type : 'value'},
      {id : 'transfer-pending-checkbox', type : 'checked'}
    ];
  }

  // ==========================================================================================

  function transferTxn2Fields() {
    return [
      {id : 'transfer-date-input', type : 'value'},
      {id : 'transfer-to-account-select', type : 'value'},
      {id : 'transfer-category-select', type : 'value'},
      {id : 'transfer-description-input', type : 'value'},
      {id : 'transfer-note-input', type : 'value'},
      {id : 'transfer-amount-input', type : 'value'},
      {id : 'transfer-deposit-txn-type', type : 'value'},
      {id : 'transfer-pending-checkbox', type : 'checked'}
    ];
  }

  // ==========================================================================================

  function buildTransferFields() {
    buildSelections(pageInfo.accounts,'transfer-from-account-select',false,'name','name',true);
    buildSelections(pageInfo.accounts,'transfer-to-account-select',false,'name','name',true);
    buildSelections(pageInfo.transfers,'transfer-category-select',false,'name','name',true);
  }

  // ==========================================================================================

  function createTransferTxns() {
    let error = checkTransferFieldsBeforeSave();

    if(!error) {
      $("#overlay").show();

      // Build New Txn
      let newTxns = [
        new Transaction(...transferTxn1Fields().map(f => document.getElementById(f.id)[f.type])),
        new Transaction(...transferTxn2Fields().map(f => document.getElementById(f.id)[f.type]))
      ];

      // Save Changes
      google
        .script
        .run
        .withSuccessHandler(afterTxnsSubmit)
        .createTransactions(newTxns);
    }
  }

  // ==========================================================================================

  function checkTransferFieldsBeforeSave() {
    let error = false;

    for(let field of transferFields()) {
      if(field.check) error = checkField(field.id,field.class,error);
    }
    return error;
  }

</script>